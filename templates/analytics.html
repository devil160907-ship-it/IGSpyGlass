{% extends "base.html" %} {% block title %}Analytics - {{ profile.username }} |
IGSpyGlass{% endblock %} {% block content %}
<div class="profile-header">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-2 text-center">
        <img
          src="{{ profile.profile_pic_url }}"
          class="rounded-circle"
          width="80"
          height="80"
          alt="{{ profile.username }}"
        />
      </div>
      <div class="col-md-10">
        <h2>{{ profile.username }} - Analytics</h2>
        <p class="mb-0">Detailed performance insights and engagement metrics</p>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-3">
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">Profile Summary</h6>
        </div>
        <div class="card-body">
          <div class="text-center mb-3">
            <img
              src="{{ profile.profile_pic_url }}"
              class="rounded-circle"
              width="80"
              height="80"
              alt="{{ profile.username }}"
            />
            <h5 class="mt-2">{{ profile.username }}</h5>
            {% if profile.is_verified %}
            <span class="badge bg-primary"
              ><i class="fas fa-check-circle"></i> Verified</span
            >
            {% endif %} {% if profile.is_private %}
            <span class="badge bg-warning"
              ><i class="fas fa-lock"></i> Private</span
            >
            {% endif %}
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number">
                {{ profile.followers|default(0)|format_number }}
              </div>
              <div class="stat-label">Followers</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">
                {{ profile.following|default(0)|format_number }}
              </div>
              <div class="stat-label">Following</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">
                {{ profile.posts_count|default(0) }}
              </div>
              <div class="stat-label">Posts</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-header">
          <h6 class="mb-0">Quick Actions</h6>
        </div>
        <div class="card-body">
          <a
            href="{{ url_for('view_profile', username=profile.username) }}"
            class="btn btn-outline-primary w-100 mb-2"
          >
            <i class="fas fa-user"></i> View Profile
          </a>
          <a
            href="{{ url_for('view_posts', username=profile.username) }}"
            class="btn btn-outline-success w-100 mb-2"
          >
            <i class="fas fa-images"></i> View Posts
          </a>
          <button
            class="btn btn-outline-info w-100"
            onclick="exportAnalytics()"
          >
            <i class="fas fa-download"></i> Export Report
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-9">
      <!-- Engagement Metrics -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-chart-line"></i> Engagement Metrics
          </h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-md-3 mb-3">
              <div class="card bg-primary text-white">
                <div class="card-body">
                  <h3>{{ "%.2f"|format(analytics.engagement_rate) }}%</h3>
                  <p class="mb-0">Engagement Rate</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card bg-success text-white">
                <div class="card-body">
                  <h3>{{ analytics.average_likes|format_number }}</h3>
                  <p class="mb-0">Avg Likes</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card bg-info text-white">
                <div class="card-body">
                  <h3>{{ analytics.average_comments|format_number }}</h3>
                  <p class="mb-0">Avg Comments</p>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="card bg-warning text-white">
                <div class="card-body">
                  <h3>{{ analytics.total_posts_analyzed }}</h3>
                  <p class="mb-0">Posts Analyzed</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Analysis -->
      <div class="row">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-images"></i> Content Distribution
              </h6>
            </div>
            <div class="card-body">
              <canvas id="contentTypeChart" width="400" height="300"></canvas>
              <div class="text-center mt-3">
                <div class="row">
                  <div class="col-6">
                    <span class="badge bg-success"
                      >{{ analytics.image_posts_count }} Images</span
                    >
                  </div>
                  <div class="col-6">
                    <span class="badge bg-primary"
                      >{{ analytics.video_posts_count }} Videos</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header">
              <h6 class="mb-0">
                <i class="fas fa-chart-bar"></i> Performance Metrics
              </h6>
            </div>
            <div class="card-body">
              <canvas id="performanceChart" width="400" height="300"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed Statistics -->
      <div class="card mt-4">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-table"></i> Detailed Statistics</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Value</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Total Engagement</strong></td>
                  <td>
                    {{ (analytics.total_likes +
                    analytics.total_comments)|format_number }}
                  </td>
                  <td>Sum of all likes and comments</td>
                </tr>
                <tr>
                  <td><strong>Average Engagement per Post</strong></td>
                  <td>
                    {{ ((analytics.total_likes + analytics.total_comments) /
                    analytics.total_posts_analyzed)|round|int|format_number }}
                  </td>
                  <td>Average interactions per post</td>
                </tr>
                <tr>
                  <td><strong>Video Content Ratio</strong></td>
                  <td>{{ analytics.video_percentage }}%</td>
                  <td>Percentage of posts that are videos</td>
                </tr>
                <tr>
                  <td><strong>Follower-to-Following Ratio</strong></td>
                  <td>
                    {{ "%.2f"|format(profile.followers / profile.following if
                    profile.following else 0) }}
                  </td>
                  <td>Followers divided by following</td>
                </tr>
                <tr>
                  <td><strong>Posts per Follower</strong></td>
                  <td>
                    {{ "%.4f"|format(profile.posts_count / profile.followers if
                    profile.followers else 0) }}
                  </td>
                  <td>Content density metric</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      {% if analytics.engagement_rate < 3 %}
      <div class="card mt-4 border-warning">
        <div class="card-header bg-warning text-dark">
          <h6 class="mb-0">
            <i class="fas fa-lightbulb"></i> Improvement Recommendations
          </h6>
        </div>
        <div class="card-body">
          <div class="alert alert-warning">
            <h6>
              <i class="fas fa-exclamation-triangle"></i> Low Engagement Rate
              Detected
            </h6>
            <p class="mb-2">
              This profile has an engagement rate of {{
              "%.2f"|format(analytics.engagement_rate) }}%, which is below the
              recommended 3% threshold.
            </p>
          </div>
          <ul>
            <li>
              Consider posting more video content (currently {{
              analytics.video_percentage }}%)
            </li>
            <li>Optimize posting times based on audience activity</li>
            <li>Use more engaging captions and call-to-actions</li>
            <li>Increase interaction with followers through comments</li>
          </ul>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function exportAnalytics() {
      showAlert('Analytics export functionality would be implemented here.', 'info');
  }

  document.addEventListener('DOMContentLoaded', function() {
      // Content Type Chart
      const contentTypeCtx = document.getElementById('contentTypeChart').getContext('2d');
      const contentTypeChart = new Chart(contentTypeCtx, {
          type: 'pie',
          data: {
              labels: ['Images', 'Videos'],
              datasets: [{
                  data: [
                      {{ analytics.image_posts_count }},
                      {{ analytics.video_posts_count }}
                  ],
                  backgroundColor: ['#198754', '#0d6efd']
              }]
          },
          options: {
              responsive: true,
              plugins: {
                  legend: {
                      position: 'bottom'
                  },
                  title: {
                      display: true,
                      text: 'Content Type Distribution'
                  }
              }
          }
      });

      // Performance Chart
      const performanceCtx = document.getElementById('performanceChart').getContext('2d');
      const performanceChart = new Chart(performanceCtx, {
          type: 'bar',
          data: {
              labels: ['Likes', 'Comments', 'Engagement Rate'],
              datasets: [{
                  label: 'Performance Metrics',
                  data: [
                      {{ analytics.average_likes }},
                      {{ analytics.average_comments }},
                      {{ analytics.engagement_rate * 10 }} // Scaled for visibility
                  ],
                  backgroundColor: ['#198754', '#0dcaf0', '#ffc107']
              }]
          },
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true
                  }
              },
              plugins: {
                  title: {
                      display: true,
                      text: 'Average Performance Metrics'
                  }
              }
          }
      });
  });
</script>
{% endblock %}
